---
id: 04406837-21c0-41eb-bae4-7b489e3529f2
---
# ä»£ç è§„èŒƒ

## å¼‚æ­¥

### callback

##### callback è¿›è¡Œé”™è¯¯å¤„ç†

```typescript
// âŒ
function callback(err, data) {
  console.log(data);
}

// âœ…
function callback(err, data) {
  if (err) {
    console.log(err);
    return;
  }

  console.log(data);
}
```

### promise

##### Promise ä¸ä½¿ç”¨ async

```typescript
// âŒ
new Promise(async (resolve, reject) => {});

// âœ…
new Promise((resolve, reject) => {});
```

##### Promise ä¸­ä¸ä½¿ç”¨ return

```typescript
// âŒ
new Promise((resolve, reject) => {
  return result;
});

// âœ…
new Promise((resolve, reject) => {
  resolve(result);
});
```

##### reject æŠ›å‡º error

```typescript
// âŒ
Promise.reject("An error occurred");

// âœ…
Promise.reject(new Error("An error occurred"));
```

##### æ€»æ˜¯ä½¿ç”¨ catch

```typescript
// âŒ
myPromise().then(() => {});

// âœ…
myPromise()
  .then(() => {})
  .catch(() => {});
```

### await/async

##### é¿å… await ç»“åˆä½¿ç”¨çš„èµ‹å€¼æ“ä½œ

```typescript
// âŒ
let totalPosts = 0;
async function getPosts(userId) {
  const users = [
    { id: 1, posts: 5 },
    { id: 2, posts: 3 },
  ];
  await sleep(Math.random() * 1000);
  return users.find((user) => user.id === userId).posts;
}
async function addPosts(userId) {
  totalPosts += await getPosts(userId);
}
await Promise.all([addPosts(1), addPosts(2)]);
console.log("Post count:", totalPosts); // 3 or 5

// âœ…
let totalPosts = 0;
async function getPosts(userId) {
  const users = [
    { id: 1, posts: 5 },
    { id: 2, posts: 3 },
  ];
  await sleep(Math.random() * 1000);
  return users.find((user) => user.id === userId).posts;
}
async function addPosts(userId) {
  const posts = await getPosts(userId);
  totalPosts += posts; // variable is read and immediately updated
}
await Promise.all([addPosts(1), addPosts(2)]);
console.log("Post count:", totalPosts);
```

##### é¿å…ä½¿ç”¨ return await

```typescript
// ğŸ‘
async () => {
  try {
    return await getUser(userId);
  } catch (error) {
    // Handle getUser error
  }
};

// ğŸ‘
async () => {
  try {
    const user = await getUser(userId);
    return user;
  } catch (error) {
    // Handle getUser error
  }
};
```

##### å¾ªç¯ä¸­ä¸ä½¿ç”¨ await

```typescript
// âŒ
for (const url of urls) {
  const response = await fetch(url);
}

// âœ…
const responses = [];
for (const url of urls) {
  const response = fetch(url);
  responses.push(response);
}

await Promise.all(responses);
```
